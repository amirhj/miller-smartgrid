<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Miller</title>

    <link href="resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <script type="text/javascript" src="resources/dist/vis.min.js"></script>
    <link href="resources/dist/vis.min.css" rel="stylesheet" type="text/css" />

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">
      #mynetwork {
        height: 600px;
        /*border: 1px solid lightgray;*/
      }
      #iterations li {
        list-style-type: none;
        margin-top: 5px;
        margin-bottom: 5px;
      }
      .selected-iteration {
        background-color: gray;
      }
    </style>
  </head>
<body>
<div class="container">
  <div class="row">
    <div class="col-md-8" id="mynetwork"></div>
    <div class="col-md-4">
      <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#iter-tab">Iterations</a></li>
        <li><a data-toggle="tab" href="#step-tab">Steps</a></li>
      </ul>
      <div class="tab-content">
        <div id="iter-tab" class="tab-pane fade in active">
          <ul id="iterations"></ul>
        </div>
        <div id="step-tab" class="tab-pane fade">
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="resources/jquery-2.1.4.min.js"></script>
<script src="resources/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript">
  var iterations = null;
  var nodes = null;
  var edges = null;
  var network = null;

  $(function() {
    $.ajax({
      url: 'results.txt',
      dataType: 'json',
      success: function(responce) {
        nodes = new vis.DataSet(responce.nodes);
        edges = new vis.DataSet(responce.edges);

        var container = document.getElementById('mynetwork');
        var data = {
          nodes: nodes,
          edges: edges
        };
        var options = {
          groups: {
            generator: {
              shape: 'image',
              image: 'resources/symbol_ac.gif'
            },
            intermittent: {
              shape: 'image',
              image: 'resources/symbol_inter.gif'
            },
            load: {
              shape: 'triangle',
              color: 'lime',
              size: 15
            }
          },
          layout: {
            hierarchical: {
              direction: 'UD'
            }
          }
        };
        network = new vis.Network(container, data, options);

        for(var i=0; i < responce.iterations.length; i++) {
          $('#iterations').append('<li class="iteration">iteration '+(i+1)+' <input type="hidden" value="'+i+'" /></li>');
        }
        $('.iteration').click(function() {
          $('.iteration').removeClass('selected-iteration');
          $(this).addClass('selected-iteration');
          applyIteration($(this).find('input').val());
        });

        iterations = responce.iterations;
      }
    });
  });

  function applyIteration(number) {
    console.log(number);
    iter = iterations[number];
    console.log(iter);
    for(var i=0; i < iter.generators.length; i++) {
      var node = nodes.get(iter.generators[i].id);
      node.label = iter.generators[i].id + '=' + iter.generators[i].value + ' kW';
      nodes.update(node);
    }
    for(var i=0; i < iter.connections.length; i++) {
      var edge = edges.get(iter.connections[i].id);
      edge.label = iter.connections[i].value + '/' + iter.connections[i].cap + ' kW';
      console.log(iter.connections[i].cap);
      console.log(edge.to+','+edge.from+','+iter.connections[i].parent);
      if(iter.connections[i].value > 0) {
        edge.arrows = (edge.to == iter.connections[i].parent) ? 'from' : 'to';
      } else {
        edge.arrows = (edge.to == iter.connections[i].parent) ? 'to' : 'from';
      }
      edges.update(edge);
    }
  }
</script>
</body>
</html>
